# Twitter Posting Setup Guide

This guide explains how to set up automated Twitter posting for high-scoring Reddit posts.

## Overview

The Twitter posting feature automatically creates humorous tweet threads from Reddit posts that:
- Were posted in the last 48 hours
- Have a score greater than 250
- Have an AI-generated summary
- Haven't been tweeted before

## Features

- ü§ñ **AI-Generated Content**: Uses OpenAI to create humorous tweet threads
- üßµ **Thread Support**: Automatically breaks content into Twitter threads
- üîÑ **Duplicate Prevention**: Tracks which posts have been tweeted
- ‚è∞ **Automated Scheduling**: Runs every 2 hours via systemd timer
- üè∑Ô∏è **Consistent Branding**: Includes AI tags and @SentientAGI mention

## Prerequisites

1. Twitter Developer Account with API v2 access
2. OpenAI API key
3. Existing Reddit/Supabase setup from the main project

## Setup Instructions

### 1. Twitter API Setup

1. Create a Twitter Developer account at [developer.twitter.com](https://developer.twitter.com)
2. Create a new project and app
3. Generate your API keys and tokens
4. Ensure your app has "Read and Write" permissions

### 2. Environment Variables

Add these environment variables to your `.env` file:

```bash
# Twitter API Credentials
TWITTER_BEARER_TOKEN=your_bearer_token_here
TWITTER_CONSUMER_KEY=your_consumer_key_here
TWITTER_CONSUMER_SECRET=your_consumer_secret_here
TWITTER_ACCESS_TOKEN=your_access_token_here
TWITTER_ACCESS_TOKEN_SECRET=your_access_token_secret_here

# OpenAI API Key (if not already set)
OPENAI_API_KEY=your_openai_api_key_here
```

### 3. Database Migration

Apply the database migration to add Twitter tracking fields:

```bash
# Connect to your Supabase database and run:
psql -f scripts/sql/migrations/add_twitter_sent_field.sql
```

### 4. Install Dependencies

Update Python dependencies:

```bash
cd scripts/
pip install tweepy>=4.16.0
# or if using uv:
uv add tweepy>=4.16.0
```

### 5. Test the Setup

Run the test script to verify everything works:

```bash
python3 test_twitter_poster.py
```

### 6. Manual Test Run

Test posting manually (this will actually post to Twitter if configured):

```bash
python3 entrypoints/run_twitter_poster.py
```

### 7. Enable Automated Posting

Install and enable the systemd service:

```bash
# Copy service files
sudo cp systemd/twitter-poster.service /etc/systemd/system/
sudo cp systemd/twitter-poster.timer /etc/systemd/system/

# Reload systemd and enable the timer
sudo systemctl daemon-reload
sudo systemctl enable twitter-poster.timer
sudo systemctl start twitter-poster.timer

# Check status
sudo systemctl status twitter-poster.timer
```

## Configuration Options

You can modify the posting criteria by editing `src/twitter_poster.py`:

- `min_score`: Minimum Reddit score (default: 250)
- `hours_back`: How far back to look for posts (default: 48 hours)
- Tweet frequency: Modify the systemd timer interval

## Monitoring

### Check Service Status
```bash
sudo systemctl status twitter-poster.service
sudo systemctl status twitter-poster.timer
```

### View Logs
```bash
# View recent logs
journalctl -u twitter-poster.service -n 50

# Follow logs in real time
journalctl -u twitter-poster.service -f
```

### Manual Trigger
```bash
# Run the service manually
sudo systemctl start twitter-poster.service
```

## Tweet Format

The generated tweets follow this format:

**First Tweet**: Hook with main point + original URL
**Middle Tweets**: Humorous elaboration on key points  
**Last Tweet**: Reddit discussion link + AI tags + dobby model attribution + @SentientAGI mention

Example tags:
```
#AI #MachineLearning #Technology #dobby

Generated by dobby model
@SentientAGI
```

## Troubleshooting

### Common Issues

1. **Authentication Failed**
   - Verify all Twitter API credentials are correct
   - Ensure app has "Read and Write" permissions
   - Check that bearer token is from the correct project

2. **No Posts Found**
   - Check if there are Reddit posts with score > 250 in last 48 hours
   - Verify posts have AI-generated summaries
   - Check database connection

3. **Tweet Too Long**
   - The system automatically handles character limits
   - If issues persist, check OpenAI prompt in `twitter_client.py`

4. **Service Won't Start**
   - Check systemd service file paths
   - Verify user permissions
   - Check environment file location

### Log Analysis

Look for these log messages:
- ‚úÖ `Successfully posted thread for post X`: Tweet posted successfully
- ‚ùå `Failed to tweet post X`: Tweet failed to post
- ‚ÑπÔ∏è `No posts found matching tweet criteria`: No posts to tweet (normal)

## Rate Limits

- Twitter API v2: 300 requests per 15-minute window
- The system includes automatic rate limiting and delays
- Posting is limited to 10 posts per cycle to prevent spam

## Security Notes

- Store API keys securely in environment variables
- Never commit credentials to version control
- Consider using different Twitter accounts for testing and production
- Monitor for any unusual posting activity

## Support

If you encounter issues:
1. Check the logs with `journalctl -u twitter-poster.service`
2. Run the test script to diagnose problems
3. Verify all environment variables are set correctly